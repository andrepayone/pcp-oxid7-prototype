{% if oView.isPcpPayment() %}
    {{ script({ include: "js/widgets/oxpayment.min.js", priority: 10 }) }}
    {{ script({ include: "js/libs/jqBootstrapValidation.min.js", priority: 10 }) }}
    {{ script({ add: "$( '#payment' ).oxPayment();" }) }}
    {{ script({ add: "$('input,select,textarea').not('[type=submit]').jqBootstrapValidation();" }) }}

    <form action="{{ oViewConf.getSslSelfLink() }}" class="form-horizontal js-oxValidate payment" id="payment" name="order" method="post" novalidate="novalidate">
        <div class="hidden">
            {{ oViewConf.getHiddenSid() }}
            {{ oViewConf.getNavFormParams() }}
            <input type="hidden" name="cl" value="{{ oViewConf.getActiveClassName() }}">
            <input type="hidden" name="fnc" value="validatepayment">
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <h3 id="paymentHeader" class="card-title">{{ translate({ ident: "PCP_MERCHANT_REFERENCE" }) }}</h3>
            </div>
            <div class="card-body">
                {% set pcpMerchantReference = oView.pcpGetMerchantReference() %}
                {% set pcpCheckoutReference = oView.pcpGetCheckoutReference() %}
                <div class="mb-3 row">
                    <label class="req col-form-label col-lg-2">{{ translate({ ident: "PCP_MERCHANT_REFERENCE" }) }}:</label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" size="20" maxlength="20" name="dynvalue[pcp_merchant_reference]" value="{{ pcpMerchantReference }}">
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="req col-form-label col-lg-2">{{ translate({ ident: "PCP_CHECKOUT_REFERENCE" }) }}:</label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" size="20" maxlength="20" name="dynvalue[pcp_checkout_reference]" value="{{ pcpCheckoutReference }}">
                    </div>
                </div>
            </div>
        </div>

        {% if oView.getPaymentList() %}
            <div class="card mb-3">
                <div class="card-header">
                    <h3 id="paymentHeader" class="card-title">{{ translate({ ident: "PAYMENT_METHOD" }) }}</h3>
                </div>
                <div class="card-body">
                    {% set inptcounter = -1 %}
                    {% for sPaymentID, paymentmethod in oView.getPaymentList() %}
                        {% set inptcounter = inptcounter + 1 %}
                        {% block select_payment %}
                            <div class="card card-body mb-2">
                                {% if sPaymentID == "oxidcashondel" %}
                                    {% include "page/checkout/inc/payment_oxidcashondel.html.twig" %}
                                {% elseif sPaymentID == "oxiddebitnote" %}
                                    {% include "page/checkout/inc/payment_oxiddebitnote.html.twig" %}
                                {% else %}
                                    {% include "page/checkout/inc/payment_other.html.twig" %}
                                {% endif %}
                            </div>
                        {% endblock %}
                    {% endfor %}
                </div>
            </div>

            {% block checkout_payment_nextstep %}
                {% if oView.isLowOrderPrice() %}
                    <div class="alert alert-info">
                        <b>{{ translate({ ident: "MIN_ORDER_PRICE" }) }} {{ oView.getMinOrderPrice() }} {{ currency.sign }}</b>
                    </div>
                {% else %}
                    <div class="card-body cart-buttons">
                        <a href="{{ seo_url({ ident: oViewConf.getOrderLink() }) }}" class="btn btn-outline-dark float-start prevStep submitButton largeButton" id="paymentBackStepBottom"><i class="fas fa-caret-left"></i> {{ translate({ ident: "PREVIOUS_STEP" }) }}</a>
                        <button type="submit" name="userform" class="btn btn-primary float-end submitButton nextStep largeButton" id="paymentNextStepBottom">{{ translate({ ident: "CONTINUE_TO_NEXT_STEP" }) }} <i class="fas fa-caret-right"></i></button>
                        <div class="clearfix"></div>
                    </div>
                {% endif %}
            {% endblock %}

        {% elseif oView.getEmptyPayment() %}
            {% block checkout_payment_nopaymentsfound %}
                <div class="lineBlock"></div>
                <h3 id="paymentHeader" class="blockHead">{{ translate({ ident: "PAYMENT_INFORMATION" }) }}</h3>
                {% ifcontent ident "oxnopaymentmethod" set oCont %}
                    {{ oCont.oxcontents__oxcontent.value }}
                {% endifcontent %}
                <input type="hidden" name="paymentid" value="oxempty">
                <div class="lineBox clear">
                    <a href="{{ seo_url({ ident: oViewConf.getSelfLink() ~ "cl=user" }) }}" class="btn btn-outline-dark float-start prevStep submitButton largeButton"><i class="fas fa-caret-left"></i> {{ translate({ ident: "PREVIOUS_STEP" }) }}</a>
                    <button type="submit" name="userform" class="btn btn-primary float-end submitButton nextStep largeButton" id="paymentNextStepBottom">{{ translate({ ident: "CONTINUE_TO_NEXT_STEP" }) }} <i class="fas fa-caret-right"></i></button>
                </div>
            {% endblock %}
        {% endif %}
    </form>
{% else %}
    {{ parent() }}
{% endif %}